<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/default_layout}"
   xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<style>
		input[type=text]{
		  width: 100%;
		  padding: 12px 20px;
		  margin: 8px 0;
		  display: inline-block;
		  border: 1px solid #ccc;
		  border-radius: 4px;
		  box-sizing: border-box;
		  font-weight:700;
		}
		.main{
			padding:40px; 
			min-height:680px;
		}
		#content{
			width: 70%;
			margin:0 auto;
		}
		#content-left{
			width:50%;
			margin:0 auto;


		}
		#content-left form{
			border-radius: 20px;
			background-color: #fff;
			padding:20px;
		}
		#content-right{
			width:50%;
			margin:0 auto;
			display: flex;
    		flex-direction: column;
		}
		#prop{
			width:100%;
			margin:10px auto;
			background:#F18949;
			border:0;
			height:60px;
		}
		#deleteBtn{
			width:auto;
			margin:10px auto;
			background:#F18949;
			border:0;
			height:40px;
		}
		label {
		 color: gray;
		}
		.modal-dialog{
		    position: fixed;
   		 	top: 20%;
    		left: 33%;
		}
		#propList {
			display: flex;
		    flex-direction: row;
		    justify-content: space-between;
		    border-bottom: 1px solid #FAB955;
		    border-radius:20px;
		    background:#fff;
		    padding:15px;
		    width: 90%;
		    margin: 5px auto;
		}
		#propBtn{
		    display: flex;
    		flex-direction: column;
    		flex-wrap: wrap;
    		height: 120px;
		}
		#propBtn button{
			margin-bottom:5px;
		}
		.list {
		  font-family: Arial, Helvetica, sans-serif;
		  border-collapse: collapse;
		  width: 100%;
		}
		
		.list td, .list th {
		  border: 1px solid #ddd;
		  padding: 2px;
		}
		
		.list tr:nth-child(even){background-color: #f2f2f2;}
		
		.list tr:hover {background-color: #ddd;}
		
		.list th {
		  text-align: left;
		  background-color: #b7472A;
		  color: white;
		}
		.modal-content-V {
			box-shadow: 4px 5px 10px 0px rgb(0 0 0 / 50%);
			background-color: rgb(255 255 255);
		}
		.modal-open{
			padding:0 !important;
		}
		#prop{
			font-size:18px;
		}
		.btn{
			color: #000;
    		background-color: #fff;
    		font-weight:700;
    	}
    	.getProp{
    		color: #000;
    		background-color: #FAB955;
    		border-color: #FAB955;
    		font-weight:700;
    	}
    	#prop:hover{
    		color:#fff;
    	}
    	.getProp:hover{
    		color:#fff !important;
    	}
    	.btn:hover{
    		color: #FAB955;
    	}
    	#propInfo{
    		font-weight:700;
    	}
	</style>
</head>
<body>
	<div layout:fragment="content">
	
		<section class="module gallery-page-header" data-background="/assets/images/estiDe.jpg" style="margin-top:50px; height: 100%;">
          <div class="container">
            <div class="row">
              <div class="col-sm-6 col-sm-offset-3">
              </div>
            </div>
          </div>
        </section>
	
		<div class="main" style="background:#FAF2E9;">
			<div id="content" style="display:flex;">
				<div id="content-left">
					<!-- ì„ íƒí¼ -->
					<form>
					  <h3><b>[[${est.eventType}]] ê²¬ì ìš”ì²­ì„œ</b></h3>
					  <h4><b>ì‘ì„±ì : [[${est.userId}]]</b></h4>
					  <label for="title" id="title" >ì°¸ê°€ì¸ì›</label>
					  <input type="text" id="pats" name="pats" th:value="${est.pats}" readonly>
					  <label for="title" id="title">í¬ë§ì¥ì†Œ</label>
					  <input type="text" id="expectedPl" name="expectedPl" th:value="${est.expectedPl}" readonly>
					      <label for="title" id="title">í–‰ì‚¬ì¼</label>
					  <input type="text" id="eventDate" name="eventDt" th:value="${est.eventDt}" readonly>
					      <label for="title" id="title">ì§„í–‰ì‹œê°„</label>
					  <input type="text" id="eventDuration" name="expectedDuration" th:value="${est.expectedDuration}" readonly>
					      <label for="title" id="title">ì§€ì—­</label>
					  <input type="text" id="expectedLocal" name="expectedLcal" th:value="${est.expectedLcal}" readonly>
					      <label for="title" id="title">í–‰ì‚¬ ê´€ë ¨ í¬ë§ì‚¬í•­</label>
					  <textarea id="wishes" name="wishes" style="width: 100%;font-size: 14px;font-weight: 700;padding: 17px;height: auto;border: 1px solid rgb(221, 221, 221);border-radius: 5px;"readonly>[[${est.wishes}]]</textarea>
					  <input type="hidden" id="thisEno" th:value="${est.eno}">
					  <input type="hidden" id="thisUserId" th:value="${est.userId}">
					</form>
					<th:block sec:authorize="isAuthenticated()">			
						<button type="button" class="btn btn-primary" sec:authorize="hasAnyRole('BUSI','ADMIN')" data-toggle="modal" data-target="#exampleModal" id="prop"><b>ê²¬ì ì œì•ˆë“±ë¡</b></button>
				 	</th:block>
					<th:block th:if="${session.member} and ${session.member.userId} == ${est.userId}">
						<button type="button" class="btn btn-primary" id="deleteBtn">ê²¬ì ì„œ ì‚­ì œ</button><br>
					</th:block>
				</div>
				<div id="content-right">
					<!-- ë¡œê·¸ì¸ëœ íšŒì› ë²„íŠ¼í‘œì‹œ-->	
					
				 	<!-- ì—…ì²´ì œì•ˆì„œ ë¦¬ìŠ¤íŠ¸ -->
					<div id="propList" th:each="prop : ${propList}">
						<div id="propInfo">
							<p th:text="|ì—…ì²´ì•„ì´ë”” : ${prop.userId}|"></p>
							<p th:text="|í•œì¤„ì–´í•„ : ${prop.companyInt}|"></p>
							<p th:text="|ì œì•ˆê¸ˆì•¡ : ${#numbers.formatInteger(prop.totalPrc, 3, 'COMMA') + 'ì›'}|"></p>
							<input type="hidden" name="pno" id="pno" >
						</div>
						<div id="propBtn">
							<th:block th:if="${session.member} and ${session.member.userId} == ${est.userId}">
								<button type="button" class="btn getProp" id="chooesProp" th:value="${prop.pno}">ì±„íƒ</button>
								<button type="button" class="btn chattingUp" th:id="${prop.userId}"> ì±„íŒ…í•˜ê¸°</button>
							</th:block>
							<th:block th:if="${session.member} and ${session.member.userId} == ${prop.userId}">
								<button type="button" class="btn" id="delProp">ì‚­ì œ</button>
							</th:block>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		
		<!-- ì œì•ˆì„œ ë³´ê¸° Modal -->
		<div class="modal fade" th:id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content-V">
		      <div class="modal-header" style="display: flex;flex-direction: row;align-items: center;">
		      	<div>
		        	<h4 class="modal-title" id="exampleModalLabel"><b>ì œì•ˆì„œ</b></h4>
		        </div>
		        <div style="position: absolute;right: 23px;top: 20px;">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
		        </div>
		      </div>
		      <div class="modal-body">
		      	<div id="companyInt">
		       		<label for="companyInt" class="col-form-label">ì—…ì²´ì†Œê°œ</label>
		       	</div>
		       	<label for="gdList" class="col-form-label">ë¬¼í’ˆëª©ë¡</label>
				<table id="fixedGdList" class="list">
					<thead>
						<tr>	
							<th>ë¬¼í’ˆëª…</th>
							<th>ê¸ˆì•¡</th>
						</tr>
					</thead>
					<tbody>
				
					</tbody>
				</table>
		       	<label for="etcList" class="col-form-label">ê¸°íƒ€ë¹„ìš©</label>
		       	<table id="fixedEtcList" class="list">
					<thead>
						<tr>
							<th>ëª…ëª©</th>
							<th>ê¸ˆì•¡</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>í–‰ì‚¬ìš´ì˜ë¹„</td>
							<td></td>
						</tr>
					</tbody>
				</table>
		       	<p id="total"></p> 
		      </div>
		      <div class="modal-footer">
		      	
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		      </div>
		    </div>
		  </div>
		</div><!--  end of Modal -->
	
		<!-- ì œì•ˆì„œ ì‘ì„± Modal -->
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		  <div class="modal-dialog" role="document" style="min-height: 480px;">
		    <div class="modal-content-V">
		      <div class="modal-header" style="display: flex;flex-direction: row;align-items: center;">
		      	<div>
		        	<h4 class="modal-title" id="exampleModalLabel"><b>ì œì•ˆì„œ ì‘ì„±</b></h4>
		        </div>
		        <div style="position: absolute;right: 23px;top: 20px;">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
		        </div>
		      </div>
		      <div class="modal-body">
		       <label for="companyInt" class="col-form-label">í•œì¤„ì–´í•„</label>
		       <input type="text" name="companyInt" class="form-control" id="recipient-name">
		       <label for="companyInt" class="col-form-label">ë¬¼í’ˆëª©ë¡</label>
		   		
				<table id="myGdList" class="list">
				<thead>
				<tr>
			    <th><input type="checkbox" id="all_select"></th>	
				<th>ë¬¼í’ˆëª…</th>
				<th>ê¸ˆì•¡</th>
				</tr>
				</thead>
				<tbody>
				
				</tbody>
				</table>
		       <label for="companyInt" class="col-form-label">ê¸°íƒ€ë¹„ìš©</label>
		       <table id="etcList" class="list">
				<thead>
				<tr>
				<th>ëª…ëª©</th>
				<th>ê¸ˆì•¡</th>
				</tr>
				</thead>
				<tbody>
				<tr>
				<td>í–‰ì‚¬ìš´ì˜ë¹„</td>
				<td><input id="price" style="border: 0" placeholder="í•„ìˆ˜ì…ë ¥"></td>
				</tr>
				</tbody>
				</table>
		       
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
		        <button type="button" class="btn getProp" id="insertBtn">ë“±ë¡</button>
		      </div>
		    </div>
		  </div>
		</div><!--  end of Modal -->
		
		<input type="hidden" name="sessionId" id="sessionId" th:value="${session.member.userId}"> 
		<script>
			//csrf ì„¤ì •
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			
			//í•´ë‹¹ì—…ì²´ì˜ ë“±ë¡ëœë¬¼í’ˆ ì¡°íšŒ
			  $(function() {
			var userId = $('input[name="sessionId"]').val();
			var data = {"userId" : userId};
			 	$.ajax({
					url: "/myGoodsList",
					method: "POST",
					data: JSON.stringify(data),
					contentType: 'application/json',
					beforeSend : function(xhr)
			        {   
						//ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤
			        xhr.setRequestHeader(header, token);
			        },
					success: function (data) {
						$.each(data, function(idx, goods){
							var tr = $("<tr />").append($("<input type=checkbox name=chk>"))
							var goodsNm = $("<td />").append(goods.goodsNm);
							var rentalPrc = $("<td class='prc'/>").append(goods.rentalPrc);
							//var stock = $("<input name=stock/>").append(goods.stock);
							tr.append(goodsNm, rentalPrc)
							$('#myGdList>tbody').append(tr);
						})
			         },
			         error: function () {
							alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
						}	
				});
			});
			 //ë¬¼í’ˆê°’ ìë™ê³„ì‚°
			 $('.modal-body').on("change", function(){
					$('#total').html("");
				    var goods = $('#myGdList tbody tr'); //ë¬¼í’ˆì˜ í–‰
				    var etc = $('#etcList tbody tr');
					var goodsSum = 0; //ë¬¼í’ˆí•©
					var etcSum = 0; //ê¸°íƒ€í•©
					var total = 0; //ì „ì²´í•©
					for(let i = 0; i < goods.length; i++){
					if($('#myGdList tbody tr').eq(i).find('input').is(":checked")) {
					 	goodsSum += parseInt($('#myGdList tbody tr').eq(i).find('td').eq(1).html());	  
					 }
					}
					 var inputVal = parseInt($('#etcList input').val());
					 console.log(inputVal)
					if(!isNaN(inputVal)){
						etcSum += inputVal;
					}
					total = goodsSum + etcSum;
					 $('#total').append("ì´ê¸ˆì•¡: "+total+"ì›");
			 }); 
			 
			 //ì œì•ˆì„œë²„íŠ¼ ëˆ„ë¥¼ì‹œ ê¸°ì¡´ì— ì‘ì„±ëœ ê¸°íƒ€ëª©ë¡ ì œê±°
			 $('#prop').on('click', function() {
				 $('#etcList tbody tr').not(":first").remove(); //ì²«ë²ˆì¨° trë¹¼ê³  ì œê±°
				 $('#etcList tbody input').val("");
				 $('#total').html("ì´ê¸ˆì•¡: "); //ì´ê¸ˆì•¡ ì´ˆê¸°í™”
				 
			 })
			 //thì²´í¬ë°•ìŠ¤ ì„ íƒì‹œ ì „ì²´ì²´í¬
			 $('#all_select').on("click", function() {
				 if($("#all_select").is(":checked")){
					 $("input[name='chk']").prop("checked", true);		 
				 } else {
					 $("input[name='chk']").prop("checked", false);
				 }
				 $("input[name=chk]").click(function() {
						var total = $("input[name=chk]").length;
						var checked = $("input[name=chk]:checked").length;
						
						if(total != checked) {
							$("#all_select").prop("checked", false);
							}
						else{
							$("#all_select").prop("checked", true);
							}
					});
			 });
			 //ê²¬ì ì„œ ì‚­ì œ
			 $('#deleteBtn').on("click", function(){
				 var thisUserId = $('#thisUserId').val();
			     var thisEno = $('#thisEno').val();
			     var userId = $('#deleteBtn').val();
			     var data = {"eno": thisEno, "userId": userId};
			     
			     //í•´ë‹¹ê²¬ì ì„œ ì‘ì„±ì ì•„ë‹ì‹œ ì‚­ì œë¶ˆê°€
				 if(userId != thisUserId) {
					 alert('ì‘ì„±ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')
					 return false;
				 }   
				 if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
					 return false;
				 }
				 $.ajax({
					 url:"/deleteEst",
					 method:"POST",
					 data: JSON.stringify(data),
					 contentType: 'application/json',
					 beforeSend : function(xhr)
			         {   /*ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤*/
							xhr.setRequestHeader(header, token);
			         },
			         success: function(data){
			        	 if(data == 1){
			        		 alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
			        		 location.href="/estList";
			        	 }
			         },
			          error: function () {
			 				alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
			 			}
				 });
			 });
			 //ì œì•ˆì„œ ë“±ë¡
			  $('#insertBtn').on("click", function(){
				 //í–‰ì‚¬ìš´ì˜ë¹„ ê¸ˆì•¡
				 var inputVal = parseInt($('#etcList input').val());
				 if(inputVal == 0){
					 alert('í–‰ì‚¬ìš´ì˜ë¹„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.')
						$("#etcList input").focus();
					 return false;
				 }
				 
				 var eno = $('#thisEno').val();
				 var userId = $('#sessionId').val();
				 var companyInt = $('#recipient-name').val();
				 var eventExps = parseInt(inputVal);
				 var totalPrc = parseInt($('#total').html().substr(5));
				 var data = {
						 "eno": eno,
						 "userId": userId,
						 "companyInt": companyInt,
						 "totalPrc": totalPrc,
						 "eventExps": eventExps
				 };
				 if(companyInt){
				  $.ajax({
					 url: "/insertProp",
					 method: "POST",
					 contentType: 'application/json',
					 data: JSON.stringify(data),
					 beforeSend : function(xhr)
			         {   //ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤
							xhr.setRequestHeader(header, token);
			         },
			         success: function(data){
						if(data == 1)
							alert('ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')
							location.reload(true)				
			         },
			          error: function () {
			 				alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
			 			}
				 	});
				 }else{
					 alert("í•œì¤„ì–´í•„ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.")
					 $('#recipient-name').focus();
				 }
			 }); 
			 //ì œì•ˆì„œ ìƒì„¸ë³´ê¸°
			 $('#getProp').on('click', function() {
				 $('#total').text("");
				 $('#companyInt').html("");
				 $('#fixedGdList tbody tr').remove();
				 var pno = $(this).parent().children('#pno').val();
				 var data = {"pno": pno};
				 $.ajax({
					 url: "/getProp",
					 method: "POST",
					 contentType: 'application/json',
					 data: JSON.stringify(data),
					 beforeSend : function(xhr)
			         {   //ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤
							xhr.setRequestHeader(header, token);
			         },
			         success: function(res){ 
			        	 var companyInt = res.companyInt;
			        	 var eventExps = res.eventExps;
			        	 var totalPrc = res.totalPrc;
			        	$('#companyInt').append(companyInt);
			            $('#fixedEtcList tbody td').eq(1).text(eventExps);
			            $('#total').text("ì´ê¸ˆì•¡: "+totalPrc+"ì›");
			        	//ì œì•ˆì„œ ë¬¼í’ˆì¡°íšŒ
			        	$.ajax({
			        		url: "/propGdList",
			        		method: "POST",
			        		data: JSON.stringify(data),
			        		contentType: 'application/json',
			        		beforeSend : function(xhr)
			                {   
			        			//ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤
			                xhr.setRequestHeader(header, token);
			                },
			        		success: function (data) {
			        			$.each(data, function(idx, goods){
			        				var tr = $("<tr />")
			        				var goodsNm = $("<td />").append(goods.goodsNm);
			        				var unitPrc = $("<td class='prc'/>").append(goods.unitPrc);
			        				//var count = $("<td class='stock'/>").append(goods.count);
			        				tr.append(goodsNm, unitPrc)
			        				$('#fixedGdList tbody').append(tr);
			        			})
			                 },
			                 error: function () {
			        				alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
			        			}	
			        	});// end of ajax in ajax
			        		
			         },
			          error: function () {
			 				alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
			 			}
				 });
			 });
			 
			 //ì œì•ˆì„œ ì‚­ì œ
			 $('#delProp').on('click', function(){
				 if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
					 return false;
				 }
				 var pno = $('#pno').val();
				 var data = {"pno": pno}
				 $.ajax({
					 url: "/delProp",
					 method: "POST",
					 data: JSON.stringify(data),
					 contentType: 'application/json',
					 beforeSend : function(xhr)
			         {   //ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤
							xhr.setRequestHeader(header, token);
			         },
			         success: function(data){
			        	if(data == 1) {
			        		alert('ì‚­ì œì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')
			        		location.href="/estList"
			        	}	
			         },
			          error: function () {
			 				alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
			 			}
				 });
			 });
			 
			 //ì œì•ˆì„œ ì±„íƒ
			 $('#chooesProp').on('click', function(){
				 if(!confirm('ì±„íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
					 return false;
				 }
				 var userId = '[[${session.member != null ? session.member.userId :""}]]';
				 var pno = this.value;
				 var data = {"pno": pno,
						 "userId":userId};
				 console.log(data);
				 $.ajax({
					 url: "/chooesProp",
					 method: "POST",
					 data: JSON.stringify(data),
					 contentType: 'application/json',
					 beforeSend : function(xhr)
			         {   //ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— í—¤ë”ì— csrfê°’ì„ ì„¤ì •í•œë‹¤
							xhr.setRequestHeader(header, token);
			         },
			         success: function(data){
			        	if(data == 1) {
			        		alert('ì±„íƒë˜ì—ˆìŠµë‹ˆë‹¤.');
			        		location.href="/estList"
			        	}	
			         },
			          error: function () {
			 				alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨");
			 			}
				 });
			 })
			 //ë¹„íšŒì› ë¡œê·¸ì¸ì°½ ë„ìš°ê¸°
			 function login(){
								 $("#header_modal").show();
							};
						 	//ì±„íŒ…ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
							$(".chattingUp").on("click", function () {
								$(".chat").toggleClass("active");
								let toId = $(this).attr('id');
								let From = $('#sessionId').val();
								//ì±„íŒ…ë°© êµ¬ë… ìƒì„±
								function createChatRoom() {
									console.log("1 ì±„íŒ…ë°© ìƒì„±");
									let chatroomDataList = new Array();
									let chatroomData1 = {
											toId : toId,
											fromId : fromId
									};
									chatroomDataList.push(chatroomData1);
									let chatroomData2 = {
											toId : fromId,
											fromId : toId
									};
									chatroomDataList.push(chatroomData2);
									
									console.log(JSON.stringify(chatroomDataList));
									
									$.ajax({
							   			url : '/chatInsert',
							   			method : 'post',
							   			data : JSON.stringify(chatroomDataList),
							   			contentType : "application/json; charset=UTF-8",
							   			beforeSend : function(xhr)
							            {  
											xhr.setRequestHeader(header, token);
							            }
							   		}).then(res => {
							   			console.log("2 ì±„íŒ…ë°© ìƒì„± ë²ˆí˜¸: " + cId);
							   			cId = res;
							   			chattingList(cId)
							   		})
								}
							   	
							   	function chattingList(cId){
							   		console.log('chattingList:', cId);
							   		$.ajax({
										url : '/chatSelect',
										method : 'post',
							   			data : JSON.stringify({toId:toId, fromId:fromId}),
							   			contentType : "application/json; charset=UTF-8",
							   			beforeSend : function(xhr)
							            {   
											xhr.setRequestHeader(header, token);
							            }
							   		}).then(res => {
							   			$(".chat-list").empty();
							   			for(r of res){
							   				$(".chat-list").append(makeList(r));
							   			}
							   			message(cId);
							   		})
							   		
							   		$(".chat-popup").show();
							   	}
						
								function makeList(r){
									let list = `<a onclick="message('${r.cid}')" class="d-flex align-items-center">
													<div class="flex-grow-1 ms-3">
														<h3>ğŸ””${r.toId}</h3>
													</div>
												 </a>`;
									return list;
								}
									
								//ì±„íŒ…í™”ë©´ì´ ë‚˜íƒ€ë‚œë‹¤.
								if ($(".chat").hasClass("active")) {
									$.ajax({
										url : '/checkChat',
										method : 'post',
							   			data : JSON.stringify({toId:toId, fromId:fromId}),
							   			contentType : "application/json; charset=UTF-8",
							   			beforeSend : function(xhr)
							            {   
											xhr.setRequestHeader(header, token);
							            }
							   		}).then(res => {
							   			if(res != ''){
							   				console.log('res.cId:', res.cid);
							   				chattingList(res.cid);
							   			} else {
							   				createChatRoom();
							   			}
							   		})
									$(".chat-popup").show();
									$(".chatbox").show();
								}
						
								//ì±„íŒ…í™”ë©´ì´ ì‚¬ë¼ì§„ë‹¤.
								if (!$(".chat").hasClass("active")) {
									$(".chat-popup").hide();
									$(".chatbox").hide();
								}
							}); 
		</script>
	</div><!-- End of layout:fragment -->
</body>
</html>