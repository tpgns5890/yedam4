<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default_layout}">

<head>
<style>
/* 화면배치  aside,section => float적용 사이즈조정
		  		  footer => clear: both; */
.contest_Container {
	padding: 20px;
	margin: 0 auto;
}

.action-filter {
	width: 1540px;
	margin: 10px;
	text-align: right;
}

aside {
	width: 200px;
	text-align: left;
	padding: 20px;
	float: left;
}

section {
	width: 1500px;
	padding: 10px;
	text-align: left;
	float: left;
	margin: 0 auto;
}

.size {
	width: 300px;
	height: 340px;
	float: left;
	margin: 20px;
	border-radius: 20px;
}

.page {
	clear: both;
}
</style>
</head>

<body>
	<div layout:fragment="content" class="content">
		<section class="hero-wrap hero-wrap-2"
			style="background-image: url(&quot;/images/bg_2.jpg&quot;); background-position: 50% 0%;"
			data-stellar-background-ratio="0.5">
			<div class="overlay"></div>
			<div class="container">
				<div
					class="row no-gutters slider-text align-items-end justify-content-center">
					<div
						class="col-md-9 ftco-animate mb-5 text-center fadeInUp ftco-animated">
						<h2 class="mb-0 bread">공모전</h2>
					</div>
				</div>
			</div>
		</section>


		<!-- 좋아요리스트 조회 및 공모전 작성 버튼 -->
		<div class="contest_Container">

			<div class="action-filter">
				<a href="/likes/List"><button id="likeListBtn">관심 공모전</button></a> <a
					href="./insert"><button>공모전 작성</button></a>

				<!-- 공모전 정렬기준 -->
				<select id="order" name="order">
					<option value="inq">조회수</option>
					<option value="pay">금액순</option>
					<option value="dt_cls" selected="selected">마감일순</option>
				</select>
			</div>

			<!-- 분류별 체크박스 -->
			<aside>
				<h3>분류별</h3>
				<ul style="list-style: none; padding-left: 0px;">
					<li><input type="checkbox" name="category" value="D1" onclick="doOpenCheck(this);">현수막</li>
					<li><input type="checkbox" name="category" value="D2" onclick="doOpenCheck(this);">배너</li>
					<li><input type="checkbox" name="category" value="D3" onclick="doOpenCheck(this);">로고</li>
					<li><input type="checkbox" name="category" value="D4" onclick="doOpenCheck(this);">포스터</li>
					<li><input type="checkbox" name="category" value="D5" onclick="doOpenCheck(this);">기타</li>
				</ul>
			</aside>

			<section class="ftco-section">
				<div class="show">
					<div id="boxList"></div>
				</div>
				<!-- 공모전 리스트 -->
			</section>
			<!-- end -->

			<!-- 페이징 -->
			<th:block th:replace="fragments/paging :: PagingFragment"></th:block>
			마지막페이지<span th:text="${paging.lastPage}"></span>



			<!-- 자바스크립트 -->
			<script th:inline="javascript">
		    /*<![CDATA[*/
		    	
			contestList(); // 첫 화면 리스트출력
			let category;
				 
				
				
				 //공모전 기본 전체리스트
				function contestList(){
					$.ajax({
	                    url : '../contest/List',
	                    method : 'post',
	                    data : JSON.stringify({order}),
	                    contentType : "application/json"
	                }).then(res => {
	                		for(contest of res){
	                			$('#boxList').append(makeBox(contest));
	                		}
	                })
	                
	                
	              //정렬기준 변경
					$('#order').on("change",orderSelect);
					
					function orderSelect(){
		        		let order = $(this).val()
		        		console.log(order);
		        		
		        		$.ajax({
		                    url : '../contest/List',
		                    method : 'post',
		                    data : {order},
		                   // contentType : "application/json" //제이슨 여러개보낼때만.
		                }).then(res=>{
		                	$('#boxList').remove();
		                	let box = $('<div>').attr("id","boxList");
		                	$('.show').append(box);
		                      for(contest of res){
		                    	  $('#boxList').append(makeBox(contest));
		                      }
		                }).catch(error =>console.log(error));
		          	};
					
					
				
					//체크박스 선택시 해당하는 분류에 대한 공고문리스트 출력 ex) 로고
				    $('input[type=checkbox][name=category]').each(function(index){
				    	$(this).change(function() {
					        if (this.checked) {
					            category = $(this).val();
					        }
					        $.ajax({
			                    url : '../contest/List',
			                    method : 'post',
			                    data : {category},
			                }).then(res=>{

			                	//등록된 공모전이 없을경우 기존페이지로 이동.
			                	if(res==''){
			                		location.href='../contest/List';
			                		alert('등록된 공모전이 없습니다');
			                	}
			                	
			                	//기존 리스트 삭제 -> div생성 붙여넣기
			                	$('#boxList').remove();
			                	let box = $('<div>').attr("id","boxList");
			                	$('.show').append(box);
			                   	 for(contest of res){
			                    	  $('#boxList').append(makeBox(contest));
			                	}
			                }).catch(error =>console.log(error));
					        
					    });
				    });
	                
				};
				
				
				//체크박스 1건만 선택가능하도록 설정.
				function doOpenCheck(check){
				    var obj = document.getElementsByName("category");
				    for(var i=0; i<obj.length; i++){
				        if(obj[i] != check){
				            obj[i].checked = false;
				        }
				    }
				}
				//공모전 1건의 대한 박스 생성
				function makeBox(contest){
					let p=`
							<div id="contestBox" class="text p-4 bg-light size box" onClick="location.href='../contest/select?cNo=${contest.cNo}'">
							
							<button style="float: right; margin: 0px;" type="button" class="btn_like">
								<span class="img_emoti" id="likeBtn">좋아요</span>
							</button>
		
							<span id="cNo">${contest.cNo}</span>
							<p id="writer">${contest.writer}</p>
							<span id="category">${contest.category}</span>
							<h3>
								<a href="#" id="ttl">${contest.ttl}</a>
							</h3>
							<div class="meta">
								<p>
									<span id="dtCls">D-${contest.dDay}</span>
								</p>
								<p>
									총 상금 :<span id="pay">${contest.pay}</span>
								</p>
								<p>
									신고수<span id="rprt">${contest.rprt}</span>
									조회수<span id="inq">${contest.inq}</span>
								</p>
								<div id="style">#${contest.style}</div>
							</div>
						</div>
						`;
				return p;
				}
				
				 /*]]>*/
				</script>
		</div>
	</div>
</body>
</html>