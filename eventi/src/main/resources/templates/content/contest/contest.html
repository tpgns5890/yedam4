<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
ul {
	list-style: none;
}
button {
	width: 150px;
	height : 70px;
	margin: 5px;
	padding: 0;
	text-align: center;
}
.question{
	width: 100px;
	height : 40px;
	margin: 5px;
	padding: 0;
	text-align: center;
}
</style>
</head>
<body>
	<div layout:fragment="content" class="content">
		<section class="hero-wrap hero-wrap-2"
			style="background-image: url(&quot;/images/bg_2.jpg&quot;); background-position: 50% 0%;"
			data-stellar-background-ratio="0.5">
			<div class="overlay"></div>
			<div class="container">
				<div
					class="row no-gutters slider-text align-items-end justify-content-center">
					<div
						class="col-md-9 ftco-animate mb-5 text-center fadeInUp ftco-animated">
						<h2 class="mb-0 bread">공모전 상세조회</h2>

					</div>
				</div>
			</div>
		</section>

		<section class="ftco-section">
			<div class="container">
				<div class="row">
					<div class="col-lg-6 mb-5 ftco-animate fadeInUp ftco-animated">
						<!-- 파일이미지 출력 -->
						<div th:each="f : ${fileList}">
							<!-- +${f.fNm} -->
							<a th:href="|@{/files/contest/}${f.fNm}|" class="image-popup prod-img-bg">
							<img th:src="|@{/files/contest/}${f.fNm}|" style="width: 540px; height: 785px" class="img-fluid" alt="Colorlib Template"></a>
						</div>
					</div>
					<div
						class="col-lg-6 product-details pl-md-5 ftco-animate fadeInUp ftco-animated">
						<span th:text=${contest.cNo} id="cNo"></span>
						<h3>
							<span th:text=${contest.category}></span>
							<span th:text=${contest.ttl}></span>
						</h3>

						<div class="rating d-flex">
							<p class="text-left mr-4">
								&#128680;<span th:text=${contest.rprt}></span> <span
									style='font-size: 30px;'>&#128065;</span><span
									th:text=${contest.inq}></span> <span class="img_emoti">좋아요</span><span
									th:text=${contest.likes}></span>
							</p>
						</div>
						<div th:each="w : ${winnerList}">
							<p class="price">
								<span
									th:text="|${w.grade}등 : ${#numbers.formatInteger(w.wPay, 0, 'COMMA') + '원'}|"></span>
							</p>
						</div>


						<div th:if="${contest.style} != null">
							<p>
								<span th:text="|#${contest.style}|"></span>
							</p>
						</div>
						<div class="row mt-4">
							<div class="input-group col-md-6 d-flex mb-3"></div>
							<div class="w-100"></div>
							<div class="col-md-12"></div>
						</div>

						전체회원
						<p>
							<a href="#" ><button type="button" class="btn btn-primary py-3 px-5 mr-2">링크복사</button></a>
							<a href="#" ><button type="button" class="btn btn-primary py-3 px-5 mr-2">응모하기</button></a>
						</p>

						공모전 등록한 회원만
						<div>
							<a th:href="@{/contest/update(cNo=${contest.cNo})}"><button type="button" class="btn btn-primary py-3 px-5 mr-2">수정</button></a>
							<button type="button" id="delBtn" class="btn btn-primary py-3 px-5">삭제</button>
						</div>
						<div>
							<a href="cart.html" ><button type="button" class="btn btn-primary py-3 px-5">마감연장</button></a>
							<a href="cart.html" ><button type="button" class="btn btn-primary py-3 px-5">결과등록</button></a>
						</div>
					</div>
				</div>

				<div class="row mt-5">
					<div class="col-md-12 nav-link-wrap">
						<div class="nav nav-pills d-flex text-center" id="v-pills-tab"
							role="tablist" aria-orientation="vertical">
							<a
								class="nav-link ftco-animate active mr-lg-1 fadeInUp ftco-animated"
								id="v-pills-1-tab" data-toggle="pill" role="tab"
								aria-controls="v-pills-1" aria-selected="true">요청사항</a> <a
								class="nav-link ftco-animate mr-lg-1 fadeInUp ftco-animated"
								id="v-pills-2-tab" data-toggle="pill" role="tab"
								aria-controls="v-pills-2" aria-selected="false">문의사항</a> <a
								class="nav-link ftco-animate fadeInUp ftco-animated"
								id="v-pills-3-tab" data-toggle="pill" role="tab"
								aria-controls="v-pills-3" aria-selected="false">참여작</a>

						</div>
					</div>

					<div class="col-md-12 tab-wrap">

						<div class="tab-content bg-light" id="v-pills-tabContent">

							<div class="tab-pane fade show active" id="v-pills-1"
								role="tabpanel" aria-labelledby="day-1-tab">
								<div class="p-4" style="height: 700px">
									<div id="contestCntn">
										 <div th:if="${contest.cntn} != null">
											<span id="question" th:text=${contest.cntn}></span>
										 </div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<script>
		let cNo = $('#cNo').text();
	
		//공모전 삭제
		$('#delBtn').on('click', delContest);
		function delContest(){
			location.href='/contest/delete/' +cNo;
		}
		
		//요청사항/문의내용/참여작 버튼이벤트
		$('#v-pills-1-tab').on('click', contentSelect);
		$('#v-pills-2-tab').on('click', questions);
		$('#v-pills-3-tab').on('click', contest);
		
		function contentSelect(){
			
			
		};
		
		function questions(){
			//문의제목 출력
			$.ajax({
	            url:"../questions/qList",
	            method:"post",
	            data : {targetId:cNo, category:'T01'},
			}).then(res => {
				$("#question").remove();
				$('#contestCntn').append($('<p>').attr("id","question"));

				//리턴값이 없으면 출력
				if(res == 0){
					$("#question").append($('<p>').append("문의사항이 없습니다."))
				}
				
				for(data of res){
					if(data.rerepTgt == null){
						$("#question").append(make(data));
					}  else {
						$("#" + data.rerepTgt).append(makeRe(data));
						
					} 
					
				}
	        })
	        
		}
		
		//문의사항 생성
		function make(question){
   			let p = `<ul>
	                  <li class="comment">
	                    <div class="comment-body" id="${question.qNo}">
	                      <h3>${question.ttl}</h3>
	                      <div class="meta">${question.writingDt}</div>
	                      <div class="meta">${question.userId}</div>
	                      <div class="meta">${question.cntn}</div>
	                      <button type="button" id="a${question.qNo}" class="question">답변등록</button>
	                      </div>
	                   </li>
                    </ul>
                	`
   			return p;
   		}
		//답변생성
		 function makeRe(questionRep){
			//답변이 있으면 id확인하고 있으면 답변등록 없애기..
   			let p = `<ul class="children">
                <li class="comment">
                <div class="comment-body">
                  <h3>${questionRep.userId}</h3>
                  <div class="meta">${questionRep.writingDt}</div>
                  <p>${questionRep.cntn}</p>
                </div>
              </li>
            </ul>`
            
            return p;
   		}
		
		
		
			
		//참여작 출력
		function contest(){
			console.log($(this));
		} 
		
		
		
			
	</script>
	</div>
</body>
</html>